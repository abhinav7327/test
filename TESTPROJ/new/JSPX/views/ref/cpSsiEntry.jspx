<!--$Id$-->
<!--$Author$-->
<!--$Date$-->

<jsp:root version="2.0"
     xmlns:jsp="http://java.sun.com/JSP/Page"
     xmlns:c="http://java.sun.com/jsp/jstl/core"
     xmlns:form="http://www.springframework.org/tags/form"
     xmlns:fn="http://java.sun.com/jsp/jstl/functions"
     xmlns:spring="http://www.springframework.org/tags"
	 xmlns:sessionConversation="http://www.nri.co.jp/sessionConversation"
	 xmlns:xenos="http://www.nri.co.jp/xenos"
	 xmlns:xenosfn ="http://www.nri.co.jp/jstl/functions"
     xmlns:tiles="http://tiles.apache.org/tags-tiles">
	 
<div class="entryContainer paddingFour">

	<jsp:element name="script">
		<jsp:attribute name="type">text/javascript</jsp:attribute>
		<jsp:attribute name="src"><c:url value="/scripts/inf/fieldvalidator.js"/></jsp:attribute>
		<jsp:body>
			//Loading Required scripts before validator is called.
              xenos.loadScript([
                  {path: xenos.context.path + '/scripts/ref/xenos-ns.js', async: false},                  
                  {path: xenos.context.path + '/scripts/inf/datevalidation.js', async: false}
              ]);
		</jsp:body>
	</jsp:element>
    
	<c:if test="${success =='false'}">
		<!-- Error message Area -->
		<ul class="xenosError">
			<c:forEach items="${value}" var="dl">		
			<li><spring:message text="${dl}" htmlEscape="false"/></li>	
			</c:forEach>
		</ul>	
	</c:if>
	
	<spring:message code="form.button.label.add" htmlEscape="false" var="formadd_label"/>
	<spring:message code="form.button.label.save" htmlEscape="false" var="formsave_label"/>
	<spring:message code="form.button.label.cancel" htmlEscape="false" var="formcancel_label"/>
	<spring:message code="ref.cpstd.form.button.label.details" htmlEscape="false" var="formdetails_label"/> 
	<spring:message code="ref.cpstd.form.button.label.diffcash" htmlEscape="false" var="formdiffcash_label"/> 
	<spring:message code="ref.cpstd.form.button.label.samecash" htmlEscape="false" var="formsamecash_label"/> 
	
	
		
		<div class="entryBlkArea ">
			<div class="formItemBlock topitems dottedBg">
								
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.counterpartycode" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.counterPartyType}-${commandForm.cpSecRule.counterPartyCode}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cprule.label.bicCode" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.bicCode}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.trdac" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.tradingAccountNo}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.cashsecurity" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.cashSecurityFlag}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.ownstanding.label.settlementfor" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.settlementFor}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.instrumenttype" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.instrumentType}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.instrumentcode" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.instrumentCode}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.settlementccy" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.settlementCcy}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.settletype" htmlEscape="false"/></label>
					
					<c:choose>
						<c:when test="${commandForm.cpSecRule.cashSecurityFlag == 'SECURITY'}">
							
							<form:select id="stlType"
								path="commandForm.cpSecRule.settlementType"
								class="dropdowninput" >
								<form:options
									items="${commandForm.stlTypeList}"
									itemLabel="label" itemValue="value" />
							</form:select>	
						</c:when>
						<c:otherwise>
							<label><spring:message code="ref.cpstd.label.free" htmlEscape="false"/></label>
						</c:otherwise>
					</c:choose>
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.countrycode" htmlEscape="false"/></label>
					<label>${commandForm.countryCode}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cprule.label.deliverymethod" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.deliveryMethod}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.priority" htmlEscape="false"/></label>
					<form:select id="priorityType"
								path="commandForm.cpSecRule.priority"
								class="dropdowninput" >
								<form:options
									items="${commandForm.priorityList}"
									itemLabel="label" itemValue="value" />
					</form:select>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.businessrelation.label.market" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.market}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.localac" htmlEscape="false"/></label>
					<label>${commandForm.cpSecRule.localAccountNo}</label>			
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<c:if test="${commandForm.cpSecRule.cashSecurityFlag == 'SECURITY'}">
					
					<c:if test="${commandForm.cpSecRule.counterPartyType != 'BROKER'}">
						<div class="formItem">
							<label><spring:message code="ref.ownstanding.label.settlementmode" htmlEscape="false"/></label>
							<label><spring:message code="ref.cpstd.label.external" htmlEscape="false"/></label>			
							<div class="clear"><spring:message text="" htmlEscape="false"/></div>
						</div>
						<div class="formItem">				
							<div class="clear"><spring:message text="" htmlEscape="false"/></div>
						</div>
						
					</c:if>
				</c:if>
				
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.brokerbic" htmlEscape="false"/></label>
					<span><form:input id="brkrBic" value="${commandForm.cpSecRule.brokerBic}"
									path="commandForm.cpSecRule.brokerBic" class="textBox "
									maxlength="15" /></span>		
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				<c:choose>
				<c:when test="${commandForm.cpSecRule.tradingAccountNo != ''}">
					<div class="formItem">
						<label><spring:message code="ref.cpstd.label.acroname" htmlEscape="false"/></label>
						<span><form:input id="valueacronym" value="${commandForm.cpSecRule.acronym}"
									path="commandForm.cpSecRule.acronym" class="textBox "
									maxlength="30" /></span>		
						<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
				</c:when>
				<c:otherwise>
					<div class="formItem">				
							<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
				</c:otherwise>
				</c:choose>
				
				
					
					<c:choose>
						<c:when test="${commandForm.cpSecRule.cashSecurityFlag == 'SECURITY'}">
							
							<div class="formItem twoCols">
								<label><spring:message code="ref.cpstd.label.beneficiaryname" htmlEscape="false"/></label>
								<span><form:input id="beneficiaryName" value="${commandForm.cpSecRule.beneficiaryName}"
									path="commandForm.cpSecRule.beneficiaryName" class="textBox "
									maxlength="100" /></span>		
								<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							<div class="formItem twoCols" id = "diffCashSecurity" style = "display:none;">
								
								<div class="formItem">
									<label><spring:message code="ref.cpstd.label.beneficiarynameforcash" htmlEscape="false"/></label>
									<span><form:input id="beneficiarynameforcash" value="${commandForm.cpCashRule.beneficiaryName}"
										path="commandForm.cpCashRule.beneficiaryName" class="textBox "
										 /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
								</div>
								<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
						</c:when>
						<c:otherwise>
							<div class="formItem">
								<label><spring:message code="ref.cpstd.label.beneficiarynameforcash" htmlEscape="false"/></label>
								<span><form:input id="beneficiarynameforcash" value="${commandForm.cpCashRule.beneficiaryName}"
									path="commandForm.cpCashRule.beneficiaryName" class="textBox "
									 /></span>		
								<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>	
						</c:otherwise>
					</c:choose>
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            
				
				
				<div class="clear"><spring:message text="" htmlEscape="false"/></div>
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.participantid" htmlEscape="false"/></label>
					<span><form:input id="participantId1" value="${commandForm.cpSecRule.participantId}"
									path="commandForm.cpSecRule.participantId" class="textBox "
									maxlength="30" /></span>		
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.participantid2" htmlEscape="false"/></label>
					<span><form:input id="participantId2" value="${commandForm.cpSecRule.participantId2}"
									path="commandForm.cpSecRule.participantId2" class="textBox "
									maxlength="20" /></span>		
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				
				<div class="clear"><spring:message text="" htmlEscape="false"/></div>
				
			</div>
		</div>		
	<!-- Global Custodian details -->
	<div id = "globalCustDetailBlock" >
		<div class="moreHandle">
					<h1 class="msgHead">
						<spring:message code="ref.cpstd.label.addheaderdtl3" htmlEscape="false"/>
						<div class="handleBlock">
						<span class="handler collapse" id="cpssiglobalcustmore"><spring:message text="" htmlEscape="false"/></span>
						</div>
					</h1>
		</div> 		

		<div class="formItemBlock more">
			<div class="moreitems dottedBg">
				<!-- TaxFee Block -->
				<div class="width100Perc">
					<div class="entryBlkArea">
						<div class="formItemBlock topitems dottedBg">
						
				<div class="formItem">
					<label class="required"><spring:message code="ref.ownstanding.label.settlementmode" htmlEscape="false"/></label>
					<label><spring:message code="ref.cpstd.label.external" htmlEscape="false"/></label>		
				<div class="clear"><spring:message text="" htmlEscape="false"/></div>
				</div>
				<!-- Custodian Bank -->
				<div class="formItem">
					<label class="required"><spring:message code="ref.cpstd.label.custodianbank" htmlEscape="false"/></label>	
						
							
					<span><form:input id="custBankGlobalSec" value="${commandForm.custBankGlobalSec}"
							path="commandForm.custBankGlobalSec" class="textBox "
							maxlength="35" /></span>
					<form:select id="globalCustCodeType"
						path="commandForm.secCpBankCodeType"
						class="dropdowninput" 
						style ="display:none;">
						<form:options
							items="${commandForm.cpBankCodeTypeList}"
							itemLabel="label" itemValue="value" />
					</form:select>
							
					<div class="popupBtn" id ="custBankGlobalSecPop" style ="display:none;">
						<input type="button" class="popupBtnIco" tgt="custBankGlobalSec" popType="finInstRoleType" brokerRoles="Bank/Custodian" value=""/>
					</div> 
							
						
						
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<!-- Settlement account -->
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/></label>
					<span><form:input id="stlAcGlobalSec" value="${commandForm.stlAcGlobalSec}"
									path="commandForm.stlAcGlobalSec" class="textBox "
									maxlength="35" /></span>		
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				<div class="formItem">
					<div class="gridAddBtn">
						<input id="globalCustDetails" type="button" value="${formdetails_label}" style = "float:right;" onclick="toggleGlobalCustodianView()"/>
					</div>
				</div>
				<div id = "globalcustDetailsDiv" style = "display:none;">
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline1" htmlEscape="false"/></label>
									<span><form:input id="acName1GlobalSec" value="${commandForm.acName1GlobalSec}"
										path="commandForm.acName1GlobalSec" class="textBox "
										maxlength="35" /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline2" htmlEscape="false"/></label>
									<span><form:input id="acName2GlobalSec" value="${commandForm.acName2GlobalSec}"
										path="commandForm.acName2GlobalSec" class="textBox "
										maxlength="35" /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline3" htmlEscape="false"/></label>
									<span><form:input id="acName3GlobalSec" value="${commandForm.acName3GlobalSec}"
										path="commandForm.acName3GlobalSec" class="textBox "
										maxlength="35" /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline4" htmlEscape="false"/></label>
									<span><form:input id="acName4GlobalSec" value="${commandForm.acName4GlobalSec}"
										path="commandForm.acName4GlobalSec" class="textBox "
										maxlength="35" /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					
				</div>
				<div class="formItem">
					<div class="gridAddBtn">
						<input id="globalCustAdd" type="button" value="${formadd_label}" style = "float:left;"/>
					</div>
				</div>
				<div class = "entryGrid">
					<div id="globalCustEntryGrid" class="xenos-grid" style="width:100%;height:150px;"><spring:message text="" htmlEscape="false"/></div>
				</div>
			</div>		
				</div>
			</div>
		</div>
      </div>
	  </div>
	  <!-- Local Custodian details -->
	  <div id = "localCustDetailBlock" >
		<div class="moreHandle">
					<h1 class="msgHead">
						<spring:message code="ref.cpstd.label.addheaderdtl4" htmlEscape="false"/>
						<div class="handleBlock">
						<span class="handler Expand" id="cpssilocalcustmore"><spring:message text="" htmlEscape="false"/></span>
						</div>
					</h1>
		</div>
		
		<div class="formItemBlock more">
			<div class="moreitems dottedBg">
				<!-- TaxFee Block -->
				<div class="width100Perc">
					<div class="entryBlkArea">
						<div class="formItemBlock topitems dottedBg">
							<div class="formItem">
								<label><spring:message code="ref.cpstd.label.custodianbank" htmlEscape="false"/></label>
								<span><form:input id="custBankLocalSec" value="${commandForm.localSecCustodian.displayBankCode}"
										path="commandForm.localSecCustodian.displayBankCode" class="textBox "
										/></span>
								<div class="popupBtn">
									<input type="button" class="popupBtnIco" tgt="custBankLocalSec" popType="finInstRoleType" brokerRoles="Bank/Custodian" value=""/>
								</div>
							</div>
							
							<div class="formItem">
									<label><spring:message code="ref.cpstd.label.custodainbankname" htmlEscape="false"/></label>
									<span><form:input id="lclSecCustBnkNm" readOnly="true" value="${commandForm.localSecCustodian.bankName}"
										path="commandForm.localSecCustodian.bankName" class="textBox "
										/></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							<div class="formItem">
									<label><spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/></label>
									<span><form:input id="stlLocalCust" value="${commandForm.localSecCustodian.displayAccountNo}"
										path="commandForm.localSecCustodian.displayAccountNo" class="textBox "
										/></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							
							<div class="formItem">
									<label style = "visibility:hidden"><spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/></label>
									
									<div class="gridAddBtn">
										<input id="lclCustDtls" type="button" value="${formdetails_label}" style = "float:left;" onclick="toggleLocalCustodianView()"/>
									</div>
									<c:if test="${commandForm.cpSecRule.cashSecurityFlag == 'SECURITY'}">
										<div class="gridAddBtn">
											<input id="diffcash" type="button" value="${formdiffcash_label}" style = "float:left; margin-left : 5px" onclick = "showDiffCash()"/>
										</div>	
										<div></div>
										<div class="gridAddBtn">
											<input id="samecash" type="button" value="${formsamecash_label}" style = "float:left;display:none; margin-left : 5px" onclick = "showSameCash()"/>
										</div>	
										<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</c:if>
							</div>
							<div class="formItem twoCols">
								<label><spring:message code="ref.cpstd.label.wayofpayment" htmlEscape="false"/></label>
								<form:select id="wayOfPay"
									path="commandForm.cpSecRule.wayOfPayment"
									class="dropdowninput" >
									<form:option value="" />
									<form:options
										items="${commandForm.wayOfPaymentList}"
										itemLabel="label" itemValue="value" />
								</form:select>			
								<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							<div id = "localcustDetailsDiv" style = "display:none;">
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline1" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline1" value="${commandForm.localSecCustodian.accountName1}"
														path="commandForm.localSecCustodian.accountName1" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline2" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline2" value="${commandForm.localSecCustodian.accountName2}"
														path="commandForm.localSecCustodian.accountName2" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline3" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline3" value="${commandForm.localSecCustodian.accountName3}"
														path="commandForm.localSecCustodian.accountName3" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline4" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline4" value="${commandForm.localSecCustodian.accountName4}"
														path="commandForm.localSecCustodian.accountName4" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
					
							</div>
							
				<!-- <div class = "entryGrid">
					<div id="localCustEntryGrid" class="xenos-grid" style="width:100%;height:150px;"><spring:message text="" htmlEscape="false"/></div>
				</div> -->
						</div>		
				</div>
			</div>
		</div>
      </div>
	  </div>
	  <div class="clear"><spring:message text="" htmlEscape="false"/></div>
	  
	  <!-- Global cash Custodian details -->
	  <div id = "globalCashCustDetailBlock" style = "display:none;">
	  <div class="moreHandle">
					<h1 class="msgHead">
						<spring:message code="ref.cpstd.label.addheaderdtl1" htmlEscape="false"/>
						<div class="handleBlock">
						<span class="handler collapse" id="cpssiglobalcashcustmore"><spring:message text="" htmlEscape="false"/></span>
						</div>
					</h1>
	  </div>
	  
	  <div class="formItemBlock more">
			<div class="moreitems dottedBg">
				<!-- TaxFee Block -->
				<div class="width100Perc">
					<div class="entryBlkArea">
						<div class="formItemBlock topitems dottedBg">
						
				<div class="formItem">
					<label class="required"><spring:message code="ref.ownstanding.label.settlementmode" htmlEscape="false"/></label>
					<label><spring:message code="ref.cpstd.label.external" htmlEscape="false"/></label>		
				<div class="clear"><spring:message text="" htmlEscape="false"/></div>
				</div>
				<!-- Custodian Bank -->
				<div class="formItem">
					<label class="required"><spring:message code="ref.cpstd.label.custodianbank" htmlEscape="false" /></label>
					
					<span><form:input id="custBankGlobalCash" value="${commandForm.custBankGlobalCash}"
							path="commandForm.custBankGlobalCash" class="textBox "
							/></span>
					<form:select id="globalCashCustCodeType"
						path="commandForm.cashCpBankCodeType"
						class="dropdowninput" 
						style ="display:none;">
						<form:options
							items="${commandForm.cpBankCodeTypeList}"
							itemLabel="label" itemValue="value" />
					</form:select>
							
					<div class="popupBtn" id ="custBankGlobalCashPop" style ="display:none;">
						<input type="button" class="popupBtnIco" tgt="custBankGlobalCash" popType="finInstRoleType" brokerRoles="Bank/Custodian" value=""/>
					</div> 
					
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				
				<!-- Settlement account -->
				<div class="formItem">
					<label><spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/></label>
					<span><form:input id="stlAcGlobalCash" value="${commandForm.stlAcGlobalCash}"
									path="commandForm.stlAcGlobalCash" class="textBox "
									/></span>		
					<div class="clear"><spring:message text="" htmlEscape="false"/></div>
	            </div>
				<div class="formItem">
					<div class="gridAddBtn">
						<input id="globalCashCustDetails" type="button" value="${formdetails_label}" style = "float:right;" onclick="toggleGlobalCashCustodianView()"/>
					</div>
				</div>
				<div id = "globalCashcustDetailsDiv" style = "display:none;">
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline1" htmlEscape="false"/></label>
									<span><form:input id="acName1GlobalCash" value="${commandForm.acName1GlobalCash}"
										path="commandForm.acName1GlobalCash" class="textBox "
										 /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline2" htmlEscape="false"/></label>
									<span><form:input id="acName2GlobalCash" value="${commandForm.acName2GlobalCash}"
										path="commandForm.acName2GlobalCash" class="textBox "
										 /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline3" htmlEscape="false"/></label>
									<span><form:input id="acName3GlobalCash" value="${commandForm.acName3GlobalCash}"
										path="commandForm.acName3GlobalCash" class="textBox "
										 /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					<div class="formItem">
									<label><spring:message code="ref.cpstd.label.Settleacnameline4" htmlEscape="false"/></label>
									<span><form:input id="acName4GlobalCash" value="${commandForm.acName4GlobalCash}"
										path="commandForm.acName4GlobalCash" class="textBox "
										 /></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
					</div>
					
				</div>
				<div class="formItem">
					<div class="gridAddBtn">
						<input id="globalCashCustAdd" type="button" value="${formadd_label}" style = "float:left;"/>
					</div>
				</div>
				
			    <div class = "entryGrid">
					<div id="globalCashCustEntryGrid" class="xenos-grid" style="width:100%;height:150px;"><spring:message text="" htmlEscape="false"/></div>
				</div> 
			</div>		
				</div>
			</div>
		</div>
      </div>
	  </div>
	  
	  <!-- Cash Local Custodian details -->
	  <div id = "localCashCustDetailBlock" style = "display:none;">
		<div class="moreHandle">
					<h1 class="msgHead">
						<spring:message code="ref.cpstd.label.addheaderdtl2" htmlEscape="false"/>
						<div class="handleBlock">
						<span class="handler Expand" id="cpssilocalcashcustmore"><spring:message text="" htmlEscape="false"/></span>
						</div>
					</h1>
		</div>
		
		<div class="formItemBlock more">
			<div class="moreitems dottedBg">
				<!-- TaxFee Block -->
				<div class="width100Perc">
					<div class="entryBlkArea">
						<div class="formItemBlock topitems dottedBg">
						
							<div class="formItem twoCols">
								<label><spring:message code="ref.ownstanding.label.settlementmode" htmlEscape="false"/></label>
								<label><spring:message code="ref.cpstd.label.external" htmlEscape="false"/></label>		
								<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							<div class="formItem">
								<label><spring:message code="ref.cpstd.label.custodianbank" htmlEscape="false"/></label>
								<span><form:input id="custBankLocalCash" value="${commandForm.localCashCustodian.displayBankCode}"
										path="commandForm.localCashCustodian.displayBankCode" class="textBox "
										/></span>
								<div class="popupBtn">
									<input type="button" class="popupBtnIco" tgt="custBankLocalCash" popType="finInstRoleType" brokerRoles="Bank/Custodian" value=""/>
								</div>
							</div>
							
							<div class="formItem">
									<label><spring:message code="ref.cpstd.label.custodainbankname" htmlEscape="false"/></label>
									<span><form:input id="lclCashCustBnkNm" value="${commandForm.localCashCustodian.bankName}"
										path="commandForm.localCashCustodian.bankName" class="textBox "
										/></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							<div class="formItem">
									<label><spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/></label>
									<span><form:input id="stlLocalCashCust" value="${commandForm.localCashCustodian.displayAccountNo}"
										path="commandForm.localCashCustodian.displayAccountNo" class="textBox "
										/></span>		
									<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>						
							
							<div class="formItem">
								<label><spring:message code="ref.cpstd.label.wayofpayment" htmlEscape="false"/></label>
								<form:select id="wayOfPay"
									path="commandForm.cpCashRule.wayOfPayment"
									class="dropdowninput" >
									<form:option value="" />
									<form:options
										items="${commandForm.wayOfPaymentList}"
										itemLabel="label" itemValue="value" />
								</form:select>
								<span class="gridAddBtn" style = "float:right;">
										<input id="lclCashCustDtls" type="button" value="${formdetails_label}" onclick="toggleLocalCashCustodianView()"/>
								</span>	
								<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							<div class="formItem twoCols">
													<label><spring:message code="ref.cprule.label.furthercredit" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline1" value="${commandForm.cpCashRule.furtherCredit}"
														path="commandForm.cpCashRule.furtherCredit" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
							</div>
							
							<div id = "localCashcustDetailsDiv" style = "display:none;">
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline1" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline1" value="${commandForm.localCashCustodian.accountName1}"
														path="commandForm.localCashCustodian.accountName1" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline2" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline2" value="${commandForm.localCashCustodian.accountName2}"
														path="commandForm.localCashCustodian.accountName2" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline3" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline3" value="${commandForm.localCashCustodian.accountName3}"
														path="commandForm.localCashCustodian.accountName3" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
									<div class="formItem">
													<label><spring:message code="ref.cpstd.label.Settleacnameline4" htmlEscape="false"/></label>
													<span><form:input id="Settleacnameline4" value="${commandForm.localCashCustodian.accountName4}"
														path="commandForm.localCashCustodian.accountName4" class="textBox "
														 /></span>		
													<div class="clear"><spring:message text="" htmlEscape="false"/></div>
									</div>
					
							</div>
							
				<!-- <div class = "entryGrid">
					<div id="localCustEntryGrid" class="xenos-grid" style="width:100%;height:150px;"><spring:message text="" htmlEscape="false"/></div>
				</div> -->
						</div>		
				</div>
			</div>
		</div>
      </div>
	 </div>
	  <div class="clear"><spring:message text="" htmlEscape="false"/></div>
	  
	  <div class="moreHandle">
					<h1 class="msgHead">
						<spring:message code="ref.cpstd.label.addheaderdtl5" htmlEscape="false"/>
						<div class="handleBlock">
						<span class="handler collapse" id="placeOfSettlementmore"><spring:message text="" htmlEscape="false"/></span>
						</div>
					</h1>
	  </div>
	
	  <div class="formItemBlock more">
			<div class="moreitems dottedBg">
				
				<div class="width100Perc">
					<div class="entryBlkArea">
						<div class="formItemBlock topitems dottedBg">
								<div class="formItem">
								<label><spring:message code="ref.cpstd.label.placeofsettlement" htmlEscape="false"/></label>
								<span><form:input id="placeOfSettleMentInput" value="${commandForm.placeOfSettlement}"
										path="commandForm.placeOfSettlement" class="textBox "
										 /></span>
								<div class="popupBtn">
									<input type="button" class="popupBtnIco" tgt="placeOfSettleMentInput" popType="finInstRoleType" actStatusContext="OPEN" value=""/>
								</div>
							</div>
						</div>		
					</div>
				</div>
			</div>
      </div> 
		
	  <div class="clear"><spring:message text="" htmlEscape="false"/></div>
	
	
	 <jsp:element name="script">
		<jsp:attribute name="type">text/javascript</jsp:attribute>
		<jsp:body>
			<!-- var mode = "<c:out value="${commandForm.cpSecRule.cashSecurityFlag}" />";
			var firstGlobalCustodianAddedForSecVal = "<c:out value="${commandForm.firstGlobalCustodianAddedForSec}" />";
			var firstGlobalCustodianAddedForCashVal = "<c:out value="${commandForm.firstGlobalCustodianAddedForCash}" />";
			if(mode == "CASH"){
				$("#globalCustDetailBlock").css("display","none");		
				$("#localCustDetailBlock").css("display","none");
				$("#globalCashCustDetailBlock").css("display","block");		
				$("#localCashCustDetailBlock").css("display","block");
				showGlobalCashDetails();				
			} else {
				showGlobalCustDetails();
			}
			applyGeneralFeatures();
			var settlementType = "<c:out value="${commandForm.cpSecRule.settlementType}" />";
			if(mode == "SECURITY"){
				if(settlementType == "FREE"){
					$("#wayOfPay").css("display","none"); 
				}
			}
			
			function showWayofPayment(){
				var stlTypeVal = $('#stlType').val();
				if(stlTypeVal == 'AGAINST'){
					$("#wayOfPay").css("display","block");
				} else {
					$("#wayOfPay").css("display","none");
				}
			}
			
			if(firstGlobalCustodianAddedForSecVal == 'true'){
				$("#custBankGlobalSecPop").css("display","block");	
			} else {
				$("#globalCustCodeType").css("display","block");
			}
			
			if(firstGlobalCustodianAddedForCashVal == 'true'){
				$("#custBankGlobalCashPop").css("display","block");	
			} else {
				$("#globalCashCustCodeType").css("display","block");
			} -->
		
				function toggleGlobalCustodianView(){
					if($("#globalcustDetailsDiv").css('display') == 'none'){
						$("#globalcustDetailsDiv").css("display","block");
					} else {
						$("#globalcustDetailsDiv").css("display","none");
					}
					
				}
				
				function toggleLocalCustodianView(){
					if($("#localcustDetailsDiv").css('display') == 'none'){
						$("#localcustDetailsDiv").css("display","block");
					} else {
						$("#localcustDetailsDiv").css("display","none");
					}
				}
				
				function toggleGlobalCashCustodianView(){
					if($("#globalCashcustDetailsDiv").css('display') == 'none'){
						$("#globalCashcustDetailsDiv").css("display","block");
					} else {
						$("#globalCashcustDetailsDiv").css("display","none");
					}
					
				}
				
				function toggleLocalCashCustodianView(){
					if($("#localCashcustDetailsDiv").css('display') == 'none'){
						$("#localCashcustDetailsDiv").css("display","block");
					} else {
						$("#localCashcustDetailsDiv").css("display","none");
					}
				}
				
				function showDiffCash(){
					$("#globalCashCustDetailBlock").css("display","block");
					$("#localCashCustDetailBlock").css("display","block");
					$("#diffcash").css("display","none");
					$("#samecash").css("display","block");
					$("#diffCashSecurity").css("display","block");
					showGlobalCashDetails();
					
				}
				
				function showSameCash(){
					$("#globalCashCustDetailBlock").css("display","none");
					$("#localCashCustDetailBlock").css("display","none");
					$("#diffcash").css("display","block");
					$("#samecash").css("display","none");
					$("#diffCashSecurity").css("display","none");
					
				}
				
				function showWayofPayment(){
					var stlTypeVal = $('#stlType').val();
					if(stlTypeVal == 'AGAINST'){
						$("#wayOfPay").css("display","block");
					} else {
						$("#wayOfPay").css("display","none");
					}
				}
				
				var xenos$Wizard$onPageLoad${commandForm.uniqueId} = function($xenos$Wizard){
				
					var mode = "<c:out value="${commandForm.cpSecRule.cashSecurityFlag}" />";
					var actionType = "<c:out value="${commandForm.actionType}" />";
					var firstGlobalCustodianAddedForSecVal = "<c:out value="${commandForm.firstGlobalCustodianAddedForSec}" />";
					var firstGlobalCustodianAddedForCashVal = "<c:out value="${commandForm.firstGlobalCustodianAddedForCash}" />";
					
					if(actionType == "ENTRY"){
						$("#formActionArea .btnsArea .wizBack .inputBtnStyle").show();
					}
					
					if(mode == "CASH"){
						$("#globalCustDetailBlock").css("display","none");		
						$("#localCustDetailBlock").css("display","none");
						$("#globalCashCustDetailBlock").css("display","block");		
						$("#localCashCustDetailBlock").css("display","block");
						showGlobalCashDetails();				
					} else {
						showGlobalCustDetails();
					}
					applyGeneralFeatures();
					var settlementType = "<c:out value="${commandForm.cpSecRule.settlementType}" />";
					if(mode == "SECURITY"){
						if(settlementType == "FREE"){
							$("#wayOfPay").css("display","none"); 
						}
					}
					
					if(firstGlobalCustodianAddedForSecVal == 'true'){
						$("#custBankGlobalSecPop").css("display","block");	
					} else {
						$("#globalCustCodeType").css("display","block");
					}
					
					if(firstGlobalCustodianAddedForCashVal == 'true'){
						$("#custBankGlobalCashPop").css("display","block");	
					} else {
						$("#globalCashCustCodeType").css("display","block");
					}
				}
		
		function applyGeneralFeatures() {
			var context = $("#content");
				var baseUrl = xenos.context.path + context.find('form').attr('action');
				
				var xenos$Handler$RequestHandler = xenos$Handler$function({
				get: {
					contentType: 'json',
					requestType: xenos$Handler$default.requestType.asynchronous
				},	
				settings: {
					beforeSend: function(request) {
						request.setRequestHeader('Accept', 'application/json');
					},
					type: 'POST'
				}
			});
			
				$('#custBankLocalSec',context).bind('change',showBankName);
				$('#stlType',context).bind('change',showWayofPayment);
				
				function showBankName(e){
					var requestUrl = baseUrl + "/displayFininstName.json?commandFormId=" + $('[name=commandFormId]').val();
							   
						xenos$Handler$RequestHandler.generic(e, {	requestUri: requestUrl,
															settings: {data : populateDisplayBankCode()},
															onJsonContent :  function(e, options, $target, content) {
															
																if(content.success == true){
																	$('#lclSecCustBnkNm',context).val(content.value[0].localSecCustodian.bankName);
																	xenos.utils.clearGrowlMessage();
																} else {
																	<!-- Not implemented in NAM -->
																	//xenos.utils.displayGrowlMessage(xenos.notice.type.error, content.value);
																}
															}
														 }
											);
				}
				
				/**
				* Populate Name X Ref request parameters.
				*/
				function populateDisplayBankCode(){
					var reqObj = {
					        "localSecCustodian.displayBankCode":  $.trim($('#custBankLocalSec',context).val()),    
							};
					return reqObj;
				}
		}
		
		function showGlobalCustDetails(){
		
			var context = $("#content");
			var baseUrl = xenos.context.path + context.find('form').attr('action');
			<!--  A common request handler to be used server communication. -->
		
			var xenos$Handler$RequestHandler = xenos$Handler$function({
				get: {
					contentType: 'json',
					requestType: xenos$Handler$default.requestType.asynchronous
				},	
				settings: {
					beforeSend: function(request) {
						request.setRequestHeader('Accept', 'application/json');
					},
					type: 'POST'
				}
			});
			
			/**
				* New Name X Ref add handler.
				*/
				function addGlobalCustEntryHandler(e){
					var valid = validateGlobalSecDetails();
					if(valid){
						var requestUrl = baseUrl + "/addGlobalCustXref.json?commandFormId=" + $('[name=commandFormId]').val();
							   
						xenos$Handler$RequestHandler.generic(e, {	requestUri: requestUrl,
															settings: {data : populateGlobalCustEntryRequestParam()},
															onJsonContent :  function(e, options, $target, content) {
															
																if(content.success == true){
																	upsertGlobalCustEntry( content.value[0]);
																	if(content.value[0].firstGlobalCustodianAddedForSec == true){
																			$("#custBankGlobalSecPop").css("display","block");
																			$("#globalCustCodeType").css("display","none");
																		} else {
																			$("#globalCustCodeType").css("display","block");
																			$("#custBankGlobalSecPop").css("display","none");
																		}
																	xenos.utils.clearGrowlMessage();
																} else {
																	
																	xenos.utils.displayGrowlMessage(xenos.notice.type.error, content.value);
																}
															}
														 }
											);
					}
					
				}
				
				/**
				* Name X Ref Delete handler
				*/
				function deleteGlobalCustEntryHandler(rowIndex, dataContext){
					var requestUrl = baseUrl + "/deleteGlobalCustXref/"+ rowIndex + ".json?commandFormId=" + $('[name=commandFormId]').val();
						xenos$Handler$RequestHandler.generic(undefined, {	requestUri: requestUrl,
																onJsonContent :  function(e, options, $target, content) {
																	if(content.success == true){
																		if(content.value[0].firstGlobalCustodianAddedForSec == true){
																			$("#custBankGlobalSecPop").css("display","block");
																			$("#globalCustCodeType").css("display","none");
																		} else {
																			$("#globalCustCodeType").css("display","block");
																			$("#custBankGlobalSecPop").css("display","none");
																		}
																		upsertGlobalCustEntry(content.value[0]);
																	} else {
																		xenos.postNotice(xenos.notice.type.error, content.value);
																	}
																}
															 }
												);
				}
				
				function validateGlobalSecDetails(){
					var validationMessages = [];
					var custBankGlobalSecVal = $.trim($('#custBankGlobalSec',context).val());
					
					if(VALIDATOR.isNullValue(custBankGlobalSecVal)){
						validationMessages.push(xenos$REF$i18n.cpSSIEntry.validation.emptyGlobalSecCustodian);
					}
					
					if(custBankGlobalSecVal.length > 35){
						validationMessages.push(xenos$REF$i18n.cpSSIEntry.validation.custBankLength);
					}
					
					var globalCustCodeTypeVal = $.trim($('#globalCustCodeType',context).val());
					if(globalCustCodeTypeVal == 'BIC'){
						if(custBankGlobalSecVal.length != 11){
							validationMessages.push(xenos$REF$i18n.cpSSIEntry.validation.custBankLengthBic);
						}
					}
					
					
					if (validationMessages.length > 0){
						 xenos.utils.displayGrowlMessage(xenos.notice.type.error, validationMessages);
						 return false;
					}else {
						   xenos.utils.clearGrowlMessage();
					}
					return true;
				}

				
				/**
				* Insert/ Update Name X Ref(s).
				*/
				function upsertGlobalCustEntry(data){
					var result = data.secCustList;
					if(result){
						globalCustEntryXRefGrid.clearData();
						for(var i in result){
							item = {};
							rowId+=1;
							item.id 				= 	"xenos_" + rowId;
							item.custodianbank 	= $.trim(result[i].displayBankCode);
							item.cpbankcodetype 	= $.trim(result[i].cpBankCodeType);
							item.custodianbankname 	= $.trim(result[i].bankName);
							item.settlementaccount 	= $.trim(result[i].displayAccountNo);
							item.Settleacnameline1 	= $.trim(result[i].accountName1);
							item.Settleacnameline2 	= $.trim(result[i].accountName2);
							item.Settleacnameline3 	= $.trim(result[i].accountName3);
							item.Settleacnameline4 	= $.trim(result[i].accountName4);
						
							globalCustEntryXRefGrid.addOrUpdateRow(item,{});
						}
						populateGlobalCustodianEntryXRefForm(data);
					}
				}
				
				/**
				* Populate Name X Ref form.
				*/
				function populateGlobalCustodianEntryXRefForm(result){
					
						$('#custBankGlobalSec',context).val(result.custBankGlobalSec);
						$('#secCpBankCodeType',context).val(result.secCpBankCodeType);
						$('#stlAcGlobalSec',context).val(result.stlAcGlobalSec);
						$('#acName1GlobalSec',context).val(result.acName1GlobalSec);
						$('#acName2GlobalSec',context).val(result.acName2GlobalSec);
						$('#acName3GlobalSec',context).val(result.acName3GlobalSec);
						$('#acName4GlobalSec',context).val(result.acName4GlobalSec);
					
				}
				
				
				
				/**
				* Populate Name X Ref request parameters.
				*/
				function populateGlobalCustEntryRequestParam(){
				
					var reqObj = {
							
					        "acName1GlobalSec":  $.trim($('#acName1GlobalSec',context).val()),    
							"acName2GlobalSec":  $.trim($('#acName2GlobalSec',context).val()),
							"acName3GlobalSec":  $.trim($('#acName3GlobalSec',context).val()),
							"acName4GlobalSec":  $.trim($('#acName4GlobalSec',context).val()),
							"stlAcGlobalSec":  $.trim($('#stlAcGlobalSec',context).val()),
					        "cpSecRule.brokerBic":	$.trim($('#brkrBic',context).val()),
							"cpSecRule.acronym":	$.trim($('#valueacronym',context).val()),
							"cpSecRule.beneficiaryName":	$.trim($('#beneficiaryName',context).val()),
							"cpSecRule.participantId":	$.trim($('#participantId1',context).val()),
							"cpSecRule.participantId2":	$.trim($('#participantId2',context).val()),
							"localSecCustodian.displayBankCode": $.trim($('#custBankLocalSec',context).val()),
							"localSecCustodian.bankName": $.trim($('#lclSecCustBnkNm',context).val()),
							"localSecCustodian.displayAccountNo":	$.trim($('#stlLocalCashCust',context).val()),
							"cpSecRule.wayOfPayment":	$.trim($('#wayOfPay',context).val()),
							"custBankGlobalSec":	$.trim($('#custBankGlobalSec',context).val()),
							"secCpBankCodeType": $("#globalCustCodeType").css("display") == 'block' ? $.trim($('#globalCustCodeType',context).val()) : "",
							
							//globalCustCodeType
							"globalCustodianName": "",
							   };
					return reqObj;
				}
				
				
					
		<!-- Global Security custodian details settings -->
			var globalCustEntryXRefResult = [],
						rowId = 0,		
						item = {},
						globalCustEntryXRefGrid = {};
					
					var globalCustEntryXRefColumns = [		
							{name:"<spring:message code="ref.cpstd.label.custodianbank" htmlEscape="false"/>", field:"custodianbank", id:"custodianbank", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.cpbankcodetype" htmlEscape="false"/>", field:"cpbankcodetype", id:"cpbankcodetype", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.custodianbankname" htmlEscape="false"/>", field:"custodianbankname", id:"custodianbankname", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/>", field:"settlementaccount", id:"settlementaccount", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline1" htmlEscape="false"/>", field:"Settleacnameline1", id:"Settleacnameline1", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline2" htmlEscape="false"/>", field:"Settleacnameline2", id:"Settleacnameline2", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline3" htmlEscape="false"/>", field:"Settleacnameline3", id:"Settleacnameline3", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline4" htmlEscape="false"/>", field:"Settleacnameline4", id:"Settleacnameline4", sortable:true}
							
						];
					var globalCustEntryXRefGridConf = {
							editMode 					: 	'delete',
							emptyColumnCheck 			: 	false,
							deleteCallback				:	deleteGlobalCustEntryHandler,
							forceFitColumns				:	true
						};	
					rowId=0;
					<xenos:out escapeXml="false">
					<c:forEach items="${commandForm.secCustList}" var="dl">
						item = {};
						rowId+=1;
						item.id 			= "xenos_" + rowId;
						item.custodianbank 	= "<c:out value="${dl.displayBankCode}" />";
						item.cpbankcodetype 	= "<c:out value="${dl.cpBankCodeType}" />";
						item.custodianbankname 	= "<c:out value="${dl.bankName}" />";
						item.settlementaccount 	= "<c:out value="${dl.displayAccountNo}" />";
						item.Settleacnameline1 	= "<c:out value="${dl.accountName1}" />";
						item.Settleacnameline2 	= "<c:out value="${dl.accountName2}" />";
						item.Settleacnameline3 	= "<c:out value="${dl.accountName3}" />";
						item.Settleacnameline4 	= "<c:out value="${dl.accountName4}" />";
						globalCustEntryXRefResult.push(item);
					</c:forEach>
					</xenos:out>	
	                globalCustEntryXRefGrid = $('#globalCustEntryGrid').xenoseditablegrid(globalCustEntryXRefResult, globalCustEntryXRefColumns, globalCustEntryXRefGridConf);
					$('#globalCustAdd',context).bind('click',addGlobalCustEntryHandler);
			
		}
		
		function showGlobalCashDetails(){
			var context = $("#content");
			var baseUrl = xenos.context.path + context.find('form').attr('action');
			var xenos$Handler$RequestHandler = xenos$Handler$function({
				get: {
					contentType: 'json',
					requestType: xenos$Handler$default.requestType.asynchronous
				},	
				settings: {
					beforeSend: function(request) {
						request.setRequestHeader('Accept', 'application/json');
					},
					type: 'POST'
				}
			});
			<!-- Global Cash custodian details settings -->
					var globalCashCustEntryXRefResult = [],
						rowId = 0,		
						item = {},
						globalCashCustEntryXRefGrid = null;
					
					var globalCashCustEntryXRefColumns = [		
							{name:"<spring:message code="ref.cpstd.label.custodianbank" htmlEscape="false"/>", field:"custodianbank", id:"custodianbank", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.cpbankcodetype" htmlEscape="false"/>", field:"cpbankcodetype", id:"cpbankcodetype", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.custodianbankname" htmlEscape="false"/>", field:"custodianbankname", id:"custodianbankname", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.settlementaccount" htmlEscape="false"/>", field:"settlementaccount", id:"settlementaccount", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline1" htmlEscape="false"/>", field:"Settleacnameline1", id:"Settleacnameline1", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline2" htmlEscape="false"/>", field:"Settleacnameline2", id:"Settleacnameline2", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline3" htmlEscape="false"/>", field:"Settleacnameline3", id:"Settleacnameline3", sortable:true},
							{name:"<spring:message code="ref.cpstd.label.Settleacnameline4" htmlEscape="false"/>", field:"Settleacnameline4", id:"Settleacnameline4", sortable:true}
							
						];
					var globalCashCustEntryXRefGridConf = {
							editMode 					: 	'delete',
							deleteCallback				:	deleteGlobalCashCustEntryHandler,
							emptyColumnCheck 			: 	false,
							forceFitColumns				:	true
						};	
					rowId=0;
					<xenos:out escapeXml="false">
					<c:forEach items="${commandForm.cashCustList}" var="dl">
						item = {};
						rowId+=1;
						item.id 			= "xenos_" + rowId;
						item.custodianbank 	= "<c:out value="${dl.displayBankCode}" />";
						item.cpbankcodetype 	= "<c:out value="${dl.cpBankCodeType}" />";
						item.custodianbankname 	= "<c:out value="${dl.bankName}" />";
						item.settlementaccount 	= "<c:out value="${dl.displayAccountNo}" />";
						item.Settleacnameline1 	= "<c:out value="${dl.accountName1}" />";
						item.Settleacnameline2 	= "<c:out value="${dl.accountName2}" />";
						item.Settleacnameline3 	= "<c:out value="${dl.accountName3}" />";
						item.Settleacnameline4 	= "<c:out value="${dl.accountName4}" />";
						globalCashCustEntryXRefResult.push(item);
					</c:forEach>
					</xenos:out>
	                globalCashCustEntryXRefGrid = $('#globalCashCustEntryGrid').xenoseditablegrid(globalCashCustEntryXRefResult, globalCashCustEntryXRefColumns, globalCashCustEntryXRefGridConf);
					
					/**
						* Name X Ref Delete handler
					*/
					function deleteGlobalCashCustEntryHandler(rowIndex, dataContext){
						var requestUrl = baseUrl + "/deleteGlobalCashCustXref/"+ rowIndex + ".json?commandFormId=" + $('[name=commandFormId]').val();
							xenos$Handler$RequestHandler.generic(undefined, {	requestUri: requestUrl,
																	onJsonContent :  function(e, options, $target, content) {
																		if(content.success == true){
																			if(content.value[0].firstGlobalCustodianAddedForCash == true){
																				$("#custBankGlobalCashPop").css("display","block");
																				$("#globalCashCustCodeType").css("display","none");
																			} else {
																				$("#globalCashCustCodeType").css("display","block");
																				$("#custBankGlobalCashPop").css("display","none");
																			}
																			upsertGlobalCashCustEntry(content.value[0]);
																		} else {
																			xenos.postNotice(xenos.notice.type.error, content.value);
																		}
																	}
																 }
													);
					}
					
					/**
				* New Name X Ref add handler.
				*/
				function addGlobalCashCustEntryHandler(e){
					
					var valid = validateGlobalCashDetails();
					if(valid){
					
						var requestUrl = baseUrl + "/addGlobalCashCustXref.json?commandFormId=" + $('[name=commandFormId]').val();
								   
						xenos$Handler$RequestHandler.generic(e, {	requestUri: requestUrl,
																settings: {data : populateGlobalCashCustEntryRequestParam()},
																onJsonContent :  function(e, options, $target, content) {
																
																	if(content.success == true){
																		if(content.value[0].firstGlobalCustodianAddedForCash == true){
																			$("#custBankGlobalCashPop").css("display","block");
																			$("#globalCashCustCodeType").css("display","none");
																		} else {
																			$("#globalCashCustCodeType").css("display","block");
																			$("#custBankGlobalCashPop").css("display","none");
																		}
																		upsertGlobalCashCustEntry( content.value[0]);
																		xenos.utils.clearGrowlMessage();
																	} else {
																		
																		xenos.utils.displayGrowlMessage(xenos.notice.type.error, content.value);
																	}
																}
															 }
												);
					
					}
				}
				
				/**
				* Populate Name X Ref request parameters.
				*/
				function populateGlobalCashCustEntryRequestParam(){
					var reqObj = {
							
									"acName1GlobalCash":  $.trim($('#acName1GlobalCash',context).val()),    
									"acName2GlobalCash":  $.trim($('#acName2GlobalCash',context).val()),
									"acName3GlobalCash":  $.trim($('#acName3GlobalCash',context).val()),
									"acName4GlobalCash":  $.trim($('#acName4GlobalCash',context).val()),
									"stlAcGlobalCash":  	$.trim($('#stlAcGlobalCash',context).val()),
									"custBankGlobalCash":	$.trim($('#custBankGlobalCash',context).val()),
									"cashCpBankCodeType": $("#globalCashCustCodeType").css("display") == 'block' ? $.trim($('#globalCashCustCodeType',context).val()) : "",
									"globalCustodianNameCash": "",
							    };
					return reqObj;
				}
				
				/**
				* Insert/ Update Name X Ref(s).
				*/
				function upsertGlobalCashCustEntry(data){
					var result = data.cashCustList;
					if(result){
						globalCashCustEntryXRefGrid.clearData();
						for(var i in result){
							item = {};
							rowId+=1;
							item.id 				= 	"xenos_" + rowId;
							item.custodianbank 	= $.trim(result[i].displayBankCode);
							item.cpbankcodetype 	= $.trim(result[i].cpBankCodeType);
							item.custodianbankname 	= $.trim(result[i].bankName);
							item.settlementaccount 	= $.trim(result[i].displayAccountNo);
							item.Settleacnameline1 	= $.trim(result[i].accountName1);
							item.Settleacnameline2 	= $.trim(result[i].accountName2);
							item.Settleacnameline3 	= $.trim(result[i].accountName3);
							item.Settleacnameline4 	= $.trim(result[i].accountName4);
						
							globalCashCustEntryXRefGrid.addOrUpdateRow(item,{});
						}
						populateGlobalCashCustodianEntryXRefForm(data);
					}
				}
				
				/**
				* Populate Name X Ref form.
				*/
				function populateGlobalCashCustodianEntryXRefForm(result){
					
						$('#custBankGlobalCash',context).val(result.custBankGlobalCash);
						$('#cashCpBankCodeType',context).val(result.cashCpBankCodeType);
						$('#stlAcGlobalCash',context).val(result.stlAcGlobalCash);
						$('#acName1GlobalCash',context).val(result.acName1GlobalCash);
						$('#acName2GlobalCash',context).val(result.acName2GlobalCash);
						$('#acName3GlobalCash',context).val(result.acName3GlobalCash);
						$('#acName4GlobalCash',context).val(result.acName4GlobalCash);
					
				}
				
				function validateGlobalCashDetails(){
					var validationMessages = [];
					var custBankGlobalCashVal = $.trim($('#custBankGlobalCash',context).val());
					
					if(VALIDATOR.isNullValue(custBankGlobalCashVal)){
						validationMessages.push(xenos$REF$i18n.cpSSIEntry.validation.emptyGlobalCashCustodian);
					}
					
					var globalCashCustCodeTypeVal = $.trim($('#globalCashCustCodeType',context).val());
					if(globalCashCustCodeTypeVal == 'BIC'){
						if(custBankGlobalCashVal.length != 11){
							validationMessages.push(xenos$REF$i18n.cpSSIEntry.validation.custBankLengthBic);
						}
					}
					
					if (validationMessages.length > 0){
						 xenos.utils.displayGrowlMessage(xenos.notice.type.error, validationMessages);
						 return false;
					}else {
						   xenos.utils.clearGrowlMessage();
					}
					return true;
				}
				
				$('#globalCashCustAdd',context).bind('click',addGlobalCashCustEntryHandler);
		}
		</jsp:body>
	</jsp:element>
	
</div>	 	 
</jsp:root>		